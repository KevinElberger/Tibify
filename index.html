<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Tibify</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:600" rel="stylesheet">
  </head>
  <body>
    <div class="title">
      <h1>Tibify</h1>
    </div>
  
    <div class="form">
      <div class="part-one">
        <input class="search-name" type="text" placeholder="Enter a player name" >
      </div>
      <div class="part-two" tabindex="-1">
        <p class="part-two-header">Notify me when this player...</p>
        <input type="checkbox" id="online-notification" name="online" class="switch-input notifications">
        <label for="online-notification" class="switch-label">Comes Online</label>
        <input type="checkbox" id="death-notification" name="death" class="switch-input notifications">
        <label for="death-notification" class="switch-label">Dies</label>
        <input type="checkbox" id="level-notification" name="level" class="switch-input notifications">
        <label for="level-notification" class="switch-label">Gains A Level</label>
        <button class="raised-button">Finish</button>
      </div>
    </div>
  
    <div class="online-now-box">
      <ul class="friends-list">
      </ul>
      <span class="online-now-usercount">0</span> friends are now online!
      <span class="up-marker"></span>
    </div>
  </body>

  <script>
    require('./renderer.js');
    var ipc = require('electron').ipcRenderer;
    var formPartOne = document.getElementsByClassName('part-one')[0];
    var formPartTwo = document.getElementsByClassName('part-two')[0];
    var friendList = document.getElementsByClassName('friends-list')[0];
    var inputField = document.getElementsByClassName('search-name')[0];
    var finishButton = document.getElementsByClassName('raised-button')[0];
    var numberOfUsers = document.getElementsByClassName('online-now-usercount')[0];
    var friendsListContainer = document.getElementsByClassName('online-now-box')[0];

    ipc.on('usersOnline', function(event, data) {
      appendOnlineUsers(data.userNames);
      numberOfUsers.innerHTML = data.numberOfUsers;
    });

    friendList.style.display = 'none';

    friendsListContainer.addEventListener('click', e => {
      if (friendList.getElementsByTagName('li').length < 1) {
        return;
      }

      if (friendList.style.display === 'none') {
        friendList.style.display = 'block';
      } else {
        friendList.style.display = 'none';
      }
    });

    inputField.addEventListener('keypress', e => {
      if (e.keyCode !== 13) {
        return;
      }

      formPartOne.style.left = '-50%';
      formPartTwo.style.display = 'inline-block';
      formPartTwo.style.left = '35%';
      formPartTwo.focus();

      formPartTwo.addEventListener('keyup', e => {
        if (e.keyCode !== 8) {
          return;
        }
        formPartOne.style.left = '33%';
        formPartTwo.style.display = 'none';
        formPartTwo.style.left = '100%';
      });

      finishButton.addEventListener('click', function() {
        let data = getFormData();
        if (inputField.value !== '') {
          inputField.value = '';
          ipc.send('valueReceived', data);
          resetForm();
        }
      });
    });

    function appendOnlineUsers(users) {
      users.forEach(user => {
        let li = document.createElement('li');
        let text = document.createTextNode(user);
        li.appendChild(text);
        friendList.appendChild(li);
      });
    }

    function getFormData() {
      let formData = {};
      let notifications = document.getElementsByClassName('notifications');

      formData.name = inputField.value;
      for (let i = 0; i < notifications.length; i++) {
        if (notifications[i].checked) {
          formData[notifications[i].name] = true;
        }
      }
      return formData;
    }

    function resetForm() {
      let toastNotification = document.createElement('div');
      let toastText = document.createTextNode('User added');

      toastNotification.classList = 'toast peek';
      toastNotification.appendChild(toastText);
      document.body.appendChild(toastNotification);
      formPartOne.style.left = '33%';
      formPartTwo.style.display = 'none';
      formPartTwo.style.left = '100%';
    }
  </script>
</html>