<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Tibify</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:600" rel="stylesheet">
  </head>
  <body>
    <div class="title">
      <h1>Tibify</h1>
    </div>
  
    <div class="form">
      <div class="part-one">
        <input class="search-name" type="text" placeholder="Enter a player name" >
      </div>
      <div class="part-two">
        <p class="part-two-header">Notify me when this player...</p>
        <input type="checkbox" id="online-notification" name="online" class="switch-input notifications">
        <label for="online-notification" class="switch-label">Comes Online</label>
        <input type="checkbox" id="death-notification" name="death" class="switch-input notifications">
        <label for="death-notification" class="switch-label">Dies</label>
        <input type="checkbox" id="level-notification" name="level" class="switch-input notifications">
        <label for="level-notification" class="switch-label">Gains A Level</label>
        <button class="raised-button">Finish</button>
      </div>
    </div>
  
    <div class="online-now-box">
      <span class="online-now-usercount"></span> friends are now online!
    </div>
  </body>

  <script>
    require('./renderer.js');
    var ipc = require('electron').ipcRenderer;
    var formPartOne = document.getElementsByClassName('part-one')[0];
    var formPartTwo = document.getElementsByClassName('part-two')[0];
    var inputField = document.getElementsByClassName('search-name')[0];
    var finishButton = document.getElementsByClassName('raised-button')[0];
    var numberOfUsers = document.getElementsByClassName('online-now-usercount')[0];

    inputField.addEventListener('keypress', function(e) {
      if (e.keyCode === 13) {
        formPartOne.style.left = '-50%';
        formPartTwo.style.display = 'inline-block';
        formPartTwo.style.left = '35%';

        finishButton.addEventListener('click', function() {
          var data = getFormData();
          inputField.value = '';
          //ipc.send('valueReceived', inputField.value);
          resetForm();
        });
      }
    });

    ipc.on('usersOnline', function(event, data) {
      numberOfUsers.innerHTML = data;
    });

    function resetForm() {
      var toastNotification = document.createElement('div');
      var toastText = document.createTextNode('User added');
      toastNotification.classList = 'toast peek';
      toastNotification.appendChild(toastText);
      document.body.appendChild(toastNotification);
      formPartOne.style.left = '33%';
      formPartTwo.style.display = 'none';
      formPartTwo.style.left = '100%';
    }

    function getFormData() {
      var formData = {};
      var notifications = document.getElementsByClassName('notifications');
      formData.name = inputField.value;
      for (var i = 0; i < notifications.length; i++) {
        if (notifications[i].checked) {
          formData[notifications[i].name] = true;
        }
      }
      return formData;
    }
  </script>
</html>